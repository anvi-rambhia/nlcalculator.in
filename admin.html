<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin — KORE Mobiles NLC Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  background: #f5f7fb;
}
header {
  background: #fff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  padding: 12px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header h2 { color: #007bff; margin: 0; font-size: 1.2rem; }
.container {
  max-width: 900px;
  margin: 20px auto;
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.07);
}
input, textarea, button {
  width: 100%;
  padding: 10px;
  margin: 6px 0 14px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 1rem;
}
button {
  background: #007bff;
  color: #fff;
  border: none;
  font-weight: 600;
  cursor: pointer;
}
button:hover { opacity: 0.9; }
.model-list {
  margin-top: 25px;
}
.model-item {
  background: #f8f8f8;
  padding: 10px 14px;
  border-radius: 10px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.model-item span { font-size: 0.95rem; }
.model-item button {
  background: crimson;
  border: none;
  color: #fff;
  padding: 5px 10px;
  border-radius: 6px;
}
.model-item button:hover { opacity: 0.8; }
</style>
</head>
<body>
<header>
  <h2>KORE Mobiles — Admin Panel</h2>
  <button id="logoutBtn">Logout</button>
</header>

<div class="container">
  <h3>Add / Update Model</h3>

  <input type="text" id="name" placeholder="Model Name (e.g., Samsung S24 Ultra)" />
  <input type="number" id="mop" placeholder="MOP (₹)" />
  <input type="number" id="dp" placeholder="DP (₹)" />
  <input type="number" id="preGstDp" placeholder="Pre-GST DP (₹)" />
  <input type="number" id="sellout" placeholder="Sellout (₹)" />
  <input type="number" id="sellin" placeholder="Sellin (₹)" />
  <input type="text" id="eligibleBanks" placeholder="Eligible Banks" />
  <input type="text" id="features" placeholder="Features" />
  <input type="number" id="upgrade" placeholder="Upgrade (Samsung only, ₹)" />
  <input type="number" id="noCostEmi" placeholder="No Cost EMI (₹)" />
  <input type="number" id="fullSwipe" placeholder="Full Swipe (₹)" />

  <button id="addModel">Save / Update Model</button>

  <div class="model-list" id="modelList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyByEiFSbsDlrCtVJjZgvbCoYPt_io2CpTk",
  authDomain: "nlcalulator.firebaseapp.com",
  projectId: "nlcalulator",
  storageBucket: "nlcalulator.firebasestorage.app",
  messagingSenderId: "783940164431",
  appId: "1:783940164431:web:edd9e24a8e6901942b433a",
  measurementId: "G-D8CXJYMPG0"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const nameInput = document.getElementById("name");
const mopInput = document.getElementById("mop");
const dpInput = document.getElementById("dp");
const preGstDpInput = document.getElementById("preGstDp");
const selloutInput = document.getElementById("sellout");
const sellinInput = document.getElementById("sellin");
const eligibleBanksInput = document.getElementById("eligibleBanks");
const featuresInput = document.getElementById("features");
const upgradeInput = document.getElementById("upgrade");
const noCostEmiInput = document.getElementById("noCostEmi");
const fullSwipeInput = document.getElementById("fullSwipe");
const addModelBtn = document.getElementById("addModel");
const modelList = document.getElementById("modelList");

onAuthStateChanged(auth, user => {
  if (!user) {
    alert("Unauthorized! Redirecting to login...");
    window.location.href = "index.html";
  }
});

document.getElementById("logoutBtn").addEventListener("click", async () => {
  await signOut(auth);
  window.location.href = "index.html";
});

async function loadModels() {
  modelList.innerHTML = "";
  const snap = await getDocs(collection(db, "mobileModels"));
  snap.forEach(docSnap => {
    const m = docSnap.data();
    const div = document.createElement("div");
    div.className = "model-item";
    div.innerHTML = `
      <span>${m.name}</span>
      <button onclick="deleteModel('${docSnap.id}')">Delete</button>
    `;
    modelList.appendChild(div);
  });
}

window.deleteModel = async function(id) {
  await deleteDoc(doc(db, "mobileModels", id));
  loadModels();
};

addModelBtn.addEventListener("click", async () => {
  const newModel = {
    name: nameInput.value,
    mop: parseFloat(mopInput.value) || 0,
    dp: parseFloat(dpInput.value) || 0,
    preGstDp: parseFloat(preGstDpInput.value) || 0,
    sellout: parseFloat(selloutInput.value) || 0,
    sellin: parseFloat(sellinInput.value) || 0,
    eligibleBanks: eligibleBanksInput.value,
    features: featuresInput.value,
    upgrade: parseFloat(upgradeInput.value) || 0,
    noCostEmi: parseFloat(noCostEmiInput.value) || 0,
    fullSwipe: parseFloat(fullSwipeInput.value) || 0
  };

  await addDoc(collection(db, "mobileModels"), newModel);
  alert("Model added successfully!");
  nameInput.value = mopInput.value = dpInput.value = preGstDpInput.value =
  selloutInput.value = sellinInput.value = eligibleBanksInput.value =
  featuresInput.value = upgradeInput.value = noCostEmiInput.value =
  fullSwipeInput.value = "";

  loadModels();
});

loadModels();
</script>
</body>
</html>
