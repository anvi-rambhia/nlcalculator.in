<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Kore Mobiles â€” Models</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
<style>
body{font-family:'Poppins',sans-serif;background:#f7f9fc;margin:0;color:#111}
.wrap{max-width:980px;margin:18px auto;padding:14px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
h2{color:#007bff;margin:0}
.panel{background:#fff;border-radius:12px;padding:12px;box-shadow:0 12px 30px rgba(0,0,0,0.06)}
.table{width:100%;border-collapse:collapse;margin-top:8px}
.table th,.table td{padding:8px;border-bottom:1px solid #eee;text-align:left}
.small{font-size:.9rem;color:#555}
.btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;background:#007bff;color:#fff}
.input-small{padding:6px;border-radius:8px;border:1px solid #eee;width:80px}
.note{font-size:.9rem;color:#666;margin-top:8px}
@media(max-width:700px){.table td{font-size:.9rem}}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <h2>ðŸ“± Available Models</h2>
    <a href="admin.html" style="text-decoration:none"><button class="btn">Admin</button></a>
  </div>

  <div class="panel">
    <p class="note">Enter percentage (for example: 10 for 10%). Final NLC = DP âˆ’ (percentage Ã— Pre-GST DP / 100)</p>
    <table class="table" id="modelsTable">
      <thead>
        <tr><th>Model</th><th>DP</th><th>Pre-GST DP</th><th>Enter %</th><th>Final NLC (â‚¹)</th></tr>
      </thead>
      <tbody id="modelsTbody"></tbody>
    </table>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

/* your firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyByEiFSbsDlrCtVJjZgvbCoYPt_io2CpTk",
  authDomain: "nlcalulator.firebaseapp.com",
  projectId: "nlcalulator",
  storageBucket: "nlcalulator.firebasestorage.app",
  messagingSenderId: "783940164431",
  appId: "1:783940164431:web:edd9e24a8e6901942b433a",
  measurementId: "G-D8CXJYMPG0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const modelCollection = "mobileModels";

function fmt(n){ if(n===undefined||n===null||n==='') return '0'; return Number(n).toLocaleString('en-IN'); }

window.loadModels = async function(){
  const tbody = document.getElementById('modelsTbody');
  tbody.innerHTML = '<tr><td colspan=5>Loading...</td></tr>';
  try {
    const q = query(collection(db, modelCollection), orderBy('name'));
    const snap = await getDocs(q);
    tbody.innerHTML = '';
    let count = 0;
    snap.forEach(docSnap=>{
      const m = docSnap.data();
      const id = docSnap.id;
      count++;
      const pre = m.preGstDp || (m.dp ? (m.dp/1.18).toFixed(2) : 0);
      tbody.innerHTML += `
        <tr id="row-${id}">
          <td><strong>${m.name||''}</strong><div class="small">${m.ram||''}/${m.rom||''}</div></td>
          <td>â‚¹${fmt(m.dp)}</td>
          <td>â‚¹${fmt(pre)}</td>
          <td><input class="input-small" id="pct-${id}" placeholder="%" oninput="calcNLC('${id}', ${m.dp || 0}, ${pre})" /></td>
          <td id="nlc-${id}">-</td>
        </tr>
      `;
    });
    if(count===0) tbody.innerHTML = '<tr><td colspan=5>No models found</td></tr>';
  } catch(e){
    console.error('loadModels error', e);
    tbody.innerHTML = '<tr><td colspan=5>Error loading models â€” check console.</td></tr>';
  }
};

window.calcNLC = function(id, dp, preGst){
  const inp = document.getElementById(`pct-${id}`);
  if(!inp) return;
  const pct = Number(inp.value) || 0;
  // Final NLC = DP - (percentage * Pre-GST DP / 100)
  const percentageValue = (Number(preGst) * (pct/100));
  const finalNLC = Number(dp) - percentageValue;
  document.getElementById(`nlc-${id}`).innerText = finalNLC>=0 ? `â‚¹${fmt(finalNLC.toFixed(2))}` : `â‚¹${fmt(finalNLC.toFixed(2))}`;
};

// initial load
loadModels();
</script>
</body>
</html>
